<div ng-controller="TripnotesShowController">
  <p id="notice"><%= notice %></p>

  <div class="cover-photo">
    <%= image_tag @tripnote.user_photo.image.url(:thumb) %>
  </div>

  <h2>
    <strong>Title:</strong>
    <%= @tripnote.title %>
  </h2>

  <p>
    <strong>Description:</strong>
    <%= @tripnote.description %>
  </p>

  <% @tripnote.user_reviews do |review| %>
    <p><%= review.description %></p>
    <p><%= image_tag(review.user_photo.authenticated_image_url(:thumb)) if review_user_photo.present? %></p>
  <% end%>

  <p>
    <strong>Created by:</strong>
    <%= @tripnote.user.name %>
  </p>

  <hr>

  <li class="collectionStatusFav"><span class="jsFavCount"><%= @tripnote.favorites.count %></span><small><%= t("tripnote.favorite") %></small></li>

  <div class="favButton">
    <% if current_user %>
      <% if Favorite.where(user_id: current_user.id, tripnote_id: @tripnote.id).present? %>
        <form ng-submit="unfavTripnote(<%= @favorite.try(:id) %>)">
          <button>Remove from favorites</button>
        </form>
      <% else %>
        <form ng-submit="favTripnote()">
          <button>Add to favorites</button>
        </form>
      <% end %>
    <% else%>
      <p>Please login first to favorite this.</p>
    <% end %>
  </div>

  <hr>

  <div class="reviews-wrapper">
    <% @tripnote.user_reviews.each do |rv| %>
      <div class="review-box" ng-controller="ReviewController">
        <h3>Review IDï¼š<%= rv.id %></h3>
        <p><%= rv.spot.name if rv.spot %></p>
        <p><%= image_tag rv.thumbnail_url %></p>
        <h4>ReviewBody:<%= rv.body %></h4>
        <%= rv.likes_count.to_s + "People want to go here!" if rv.likes %>
        <% rv.likes.each do |like| %>
        <div class="liked-users"><%= image_tag like.user.thumbnail_url %></div>
        <% end%>
        <br>
        <% like = @likes.find {|like| like.like_id == rv.id} %>
          <% if rv.spot_id %>
            <button ng-show = "!likeId" ng-click="addLike()"
              ng-init="spotId = <%= rv.spot_id %>"
              ng-init="spotName = <%= rv.spot.name %>"
              ng-init="currentUserUsername = <%= current_user.username %>"
              ng-init="currentUserName = <%= current_user.name %>"
              ng-init="countryUrlName = <%= rv.spot.country.url_name %>"
              ng-init="countryName = <%= rv.spot.country.trans_name(I18n.locale) %>"
            >Wish to go!!</button>
            <button ng-show = "!!likeId" ng-click="removeLike()"
              <% if like %>
              ng-init="likeId = <%= like.id %>"
              <% end %>
              ng-init="spotId = <%= rv.spot_id %>"
              ng-init="spotName = <%= rv.spot.name %>"
              ng-init="currentUserUsername = <%= current_user.username %>"
              ng-init="currentUserName = <%= current_user.name %>"
              ng-init="countryUrlName = <%= rv.spot.country.url_name %>"
              ng-init="countryName = <%= rv.spot.country.trans_name(I18n.locale) %>"
            >Remove from wishlists!!</button>
          <% end %>
        <hr>
        <h4>Add your comment</h4>
        <% if current_user %>
          <%= image_tag current_user.thumbnail_url %>
          <form role="form" ng-submit="addReviewComment()">
            <div class="form-group" ng-init="reviewId = <%= rv.id %>">
              <input type="text" class="form-control" placeholder="<%= t("tripnote.add_comment") %>" ng-show="!isSaving" ng-disabled="!!isSaving" ng-model="reviewNewComment">
            </div>
          </form>
        <% end %>
        <hr>
        <h4>Users' comments</h4>
        <% if rv.comments.present? %>
          <% rv.comments.each do |rvCm| %>
            <%= image_tag rvCm.user.thumbnail_url%>
            <p><%= rvCm.body %></p>
          <% end %>
        <% else %>
          <p>Nothing yet.</p>
        <% end %>
        <hr>
      </div><!-- .review-box -->
    <% end %>
  </div>

  <hr>
  <h2>Comments</h2>

  <div>
    <% @tripnote.comments.each do |cm| %>
      <%= image_tag cm.user.thumbnail_url%>
      <p><%= cm.body %></p>
    <% end %>
  </div>

  <form role="form" ng-submit="addComment()">
    <div class="form-group">
      <input type="text" class="form-control" placeholder="<%= t("tripnote.add_comment") %>" ng-show="!isSaving" ng-disabled="!!isSaving" ng-model="logbookNewComment">
    </div>
  </form>

  <hr>

  <%= link_to 'Back', tripnotes_path %>
  <%= link_to 'Edit', edit_tripnote_path(@tripnote) %>
</div>